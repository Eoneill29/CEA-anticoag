"0","### CEA with Monte Carlo Simulation ###"
"0",""
"0","#Number of MC Samples"
"0","n_samples <- 1000"
"0","#Set the random number seed for reproducibility"
"0","set.seed(123) "
"0",""
"0","##Warfarin"
"0","#Health States "
"0","#Event rates per person-6months converted to person-year:"
"0","sample_r.ne_vr   <- rgamma(n_samples, shape = 20, rate = 10000) * 2       # rate of no event to VTE recurrence "
"0","sample_r.ne_mb   <- rgamma(n_samples, shape = 84, rate = 716 + 84) * 2    # rate of no event to  major bleed "
"0","sample_r.ne_nmb  <- rgamma(n_samples, shape = 30, rate = 170 + 30) * 2    # rate of no event to CRNMB"
"0","sample_r.nmb_ot  <- runif(n_samples, min = 0, max = 0.20) * 2             # rate of CNMB to come off treatment  "
"0","sample_r.mb_ot   <- runif(n_samples, min = 0, max = 0.20) * 2             # rate of MB to come off treatment "
"0",""
"0","#Transition probabilities (per month cycle): "
"0","sample_pr.ne_vr   <- 1 - exp(-sample_r.ne_vr * cycle_length)        # from no event to VTE recurrence "
"0","sample_pr.ne_mb   <- 1 - exp(-sample_r.ne_mb * cycle_length)        # from no event to  major bleed "
"0","sample_pr.ne_nmb  <- 1 - exp(-sample_r.ne_nmb * cycle_length)       # from no event to CRNMB"
"0","sample_pr.nmb_ot  <- 1 - exp(-sample_r.nmb_ot * cycle_length)       # from CNMB to come off treatment  "
"0","sample_pr.mb_ot   <- 1 - exp(-sample_r.mb_ot * cycle_length)        # from MB to come off treatment "
"0",""
"0","# Create dataframe of lists of parameter values for state transition probabilities"
"0","l.probr <- list()"
"0","for (i in 1:n_samples){"
"0","  sample.l.probr <- list(pr.ne_vr = sample_pr.ne_vr[i],"
"0","                         pr.ne_mb = sample_pr.ne_mb[i],"
"0","                         pr.ne_nmb = sample_pr.ne_nmb[i],"
"0","                         pr.ne_ne = 1 - sum(sample_pr.ne_vr[i],"
"0","                                            sample_pr.ne_mb[i],"
"0","                                            sample_pr.ne_nmb[i]),"
"0","                         pr.nmb_ot = sample_pr.nmb_ot[i],"
"0","                         pr.mb_ot = sample_pr.mb_ot[i])"
"0","  l.probr[i] <- list(sample.l.probr)"
"0","}"
"0","df.probr <- as.data.frame(do.call(rbind, l.probr))"
"0","#df.probr <- df.probr %>% rowwise() %>% mutate(sum_test = sum(pr.ne_ne, pr.ne_vr, pr.ne_mb, pr.ne_nmb))"
"0",""
"0","##Costs (per 6 months (year/2))"
"0","c.ne      <- 165  / 12              #Cost for staying healthy in Warfarin arm"
"0","c.vr      <- 267  / 12              #Cost for VTE recurrence in Warfarin arm ($102)  "
"0","c.mb      <- 435  / 12              #Cost for major bleed in Warfarin arm ($270)"
"0","c.nmb     <- 332  / 12              #Cost for CRNMB in Warfarin arm ($167)"
"0","c.ot      <- 0    / 12              #Cost of off treatment"
"0",""
"0","##Utility Values "
"0","u.ne    <- 0.825               #Utility of No Event"
"0","u.vr    <- 0.76                #Utility of recurrence  "
"0","u.mb    <- 0.61                #Utility of major bleed"
"0","u.nmb   <- 0.65                #Utility of CRNMB "
"0","u.ot    <- 0.59                #Utility of off treatment "
"0",""
"0","##Vectors for cost and utility values "
"0","v.cost <- c(c.ne, c.vr, c.mb, c.nmb, c.ot)"
"0","v.util <- c(u.ne, u.vr, u.mb, u.nmb, u.ot)"
"0",""
"0","## Generate an input dataframe containing parameters for each simulation"
"0","input_params <- as.data.frame(cbind(nsim = seq(1, n_samples),"
"0","                                 n.t = rep(n.t, n_samples),"
"0","                                 d.c = rep(d.c, n_samples),"
"0","                                 d.e = rep(d.e, n_samples),"
"0","                                 v.n = rep(list(v.n), n_samples),"
"0","                                 v.cost = rep(list(v.cost), n_samples),"
"0","                                 v.util = rep(list(v.util), n_samples),"
"0","                                 v.M_1 = rep(list(v.M_1), n_samples),"
"0","                                 pr.ne_ne = df.probr$pr.ne_ne,"
"0","                                 pr.ne_vr = df.probr$pr.ne_vr,"
"0","                                 pr.ne_mb = df.probr$pr.ne_mb,"
"0","                                 pr.ne_nmb = df.probr$pr.ne_nmb,"
"0","                                 pr.mb_ot = df.probr$pr.mb_ot,"
"0","                                 pr.nmb_ot = df.probr$pr.nmb_ot))"
"0",""
"0","input_params$nsim = as.character(input_params$nsim)"
"0","input_params$n.t = as.numeric(input_params$n.t)"
"0","input_params$d.c = as.numeric(input_params$d.c)"
"0","input_params$d.e = as.numeric(input_params$d.e)"
"0","input_params$pr.ne_ne = as.numeric(input_params$pr.ne_ne)"
"0","input_params$pr.ne_vr = as.numeric(input_params$pr.ne_vr)"
"0","input_params$pr.ne_mb = as.numeric(input_params$pr.ne_mb)"
"0","input_params$pr.ne_nmb = as.numeric(input_params$pr.ne_nmb)"
"0","input_params$pr.mb_ot = as.numeric(input_params$pr.mb_ot)"
"0","input_params$pr.nmb_ot = as.numeric(input_params$pr.nmb_ot)"
"0",""
